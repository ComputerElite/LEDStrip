<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ComputerElite LED Strip</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <label>
        <select onchange="if(liveUpdate) SetAnimation()" id="animations">
    
        </select>
        <button onclick="SetAnimation()">Set animation</button>
    </label>
    <br>
    <label>
        <input onchange="if(liveUpdate) SetStep()"  type="number" placeholder="step" id="step">
        <button onclick="SetStep()">Set step</button>
    </label>
    <br>
    <label>
        <input onchange="if(liveUpdate) SetDelay()"  type="number" placeholder="delay" id="delay">
        <button onclick="SetDelay()">Set delay</button>
    </label>
    <br>
    <label>
        <input onchange="if(liveUpdate) SetShortDelay()" type="number" placeholder="short delay" id="shortDelay">
        <button onclick="SetShortDelay()">Set short delay</button>
    </label>
    <br>
    <label>
        <input type="range" min="0" max="255" step="1" value="255" oninput="SetBrightness(value)" id="brightnessRange">
        <input onchange="if(liveUpdate) SetBrightness(value)" type="number" placeholder="brightness" id="brightness">
        <button onclick="SetBrightness()">Set brightness</button>
    </label>
    <br>
    <label>
        <input oninput="if(liveUpdate) SetColor0()" onchange="if(liveUpdate) SetColor0()"  type="color" id="color0">
        <button onclick="SetColor0()">Set color0</button>
    </label>
    <script>
        const animationSelector = document.getElementById("animations");
        const step = document.getElementById("step");
        const color0 = document.getElementById("color0");
        const delay = document.getElementById("delay");
        const shortDelay = document.getElementById("shortDelay");
        const brightness = document.getElementById("brightness");
        const brightnessRange = document.getElementById("brightnessRange");
        var liveUpdate = true;
        
        
        fetch(`/api/animations`)
            .then(response => response.json())
            .then(json => {
                for(const [key, value] of Object.entries(json)) {
                    const option = document.createElement("option");
                    option.value = key;
                    option.innerText = value;
                    animationSelector.appendChild(option);
                }
            })
        
        fetch(`/api/strip`)
            .then(response => response.json())
            .then(json => {
                step.value = json.currentStep;
                animationSelector.value = json.currentAnimation;
                color0.value = json.color0;
                delay.value = json.msDelay;
                shortDelay.value = json.shortDelay;
                brightness.value = json.brightness;
                brightnessRange.value = json.brightness;
            })
        
        function SetBrightness(value = -1) {
            if(value != -1) {
                brightness.value = value;
                brightnessRange.value = value;
            }
            fetch(`/api/setbrightness`, {
                method: "POST",
                body: brightness.value
            });
        }
        
        function SetColor0() {
            fetch(`/api/setcolor0`, {
                method: "POST",
                body: color0.value
            });
        }
        
        function SetDelay() {
            fetch(`/api/setdelay`, {
                method: "POST",
                body: delay.value
            });
        }
        
        function SetShortDelay() {
            fetch(`/api/setshortdelay`, {
                method: "POST",
                body: shortDelay.value
            });
        }
        
        function SetStep() {
            fetch(`/api/setstep`, {
                method: "POST",
                body: step.value
            });
        }
        
        function SetAnimation() {
            const animation = animationSelector.value;
            fetch(`/api/setanimation`, {
                method: "POST",
                body: animation
            });
        }
    </script>
</body>
</html>